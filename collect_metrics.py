#!/usr/bin/env python3

import argparse
import os
import re
import json

import pandas as pd

parser = argparse.ArgumentParser(description='')
parser.add_argument('--results_dir', type=str, default='outputs/')
args = parser.parse_args()

all_metrics = "["
for file_name in os.listdir(args.results_dir):
    if not re.search(r'.*metrics.*\.json', file_name):
        continue

    file_path = os.path.join(args.results_dir, file_name)
    with open(file_path, 'r') as f:
        all_metrics = all_metrics + f.read().rstrip() + ','
all_metrics = all_metrics[:-1] + ']'

df = pd.json_normalize(json.loads(all_metrics))
df.to_csv('all_metrics.csv')
